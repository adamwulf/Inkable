<html>
    <head>
        <style>
            #body {
                width: 70%;
                max-width: 1024pt;
                margin: 80pt auto;
            }
            .mermaidTooltip {
                position: absolute;
                padding: 2pt 3pt;
                background: white;
                border-radius: 4pt;
                border: 1pt solid black;
                max-width: 240pt;
            }
        </style>
        <script src='https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js'></script>
        <script>
            function emptyCallback() {
                // noop
            }
        </script>
    </head>
    <body>

        <div id='body'>
            <div class="mermaid">
                flowchart TD

                S1[TouchEventStream]
                S2[TouchPathStream]
                S3[PolylineStream]

                S1 --> S2
                S2 --> S3

                subgraph PolylineFilters
                    S4A[NaiveSavitzkyGolay]
                    S4B[NaiveDouglasPeucker]
                    S4C[NaivePointDistance]
                end

                S3 --> PolylineFilters

                subgraph BezierSmoothers
                    SM1[AntigrainSmoother]
                    SM2[LinearSmoother]
                end

                S5[BezierStream]

                BezierSmoothers -.-> S5
                PolylineFilters --> S5

                subgraph Renderers
                    S8[PointView]
                    S9[PolylineView]
                    S10[BezierView]
                end

                S2 --> S8
                PolylineFilters --> S9
                S5 --> S10

                click S1 emptyCallback "Transforms incoming UITouch events into Codable TouchEvent objects. Produces a stream of these events"
                click S2 emptyCallback "Coalesces TouchEvents into TouchPath.Points, and produces the paths generated by the incoming points, including which Points along each path have recently updated."
                click S3 emptyCallback "Wraps each TouchPath object in a Polyline struct so that the filters in the next step operate on value types instead of objects. This lets each filter maintain its own cache of the Polylines without worry that another filter would modify it by reference."
                click S4A "https://en.wikipedia.org/wiki/Savitzky%E2%80%93Golay_filter" "Smooths the input polyline. Click for more information."
                click S4B "https://en.wikipedia.org/wiki/Ramer%E2%80%93Douglas%E2%80%93Peucker_algorithm" "Reduces the number of points needed to keep the same shape of the input polyline. Click for more information."
                click S4C emptyCallback "Reduces the number of points of the input polylines by removing points within a minimum distance threshold to a neighboring point."
                click S5 emptyCallback "Converts the input polyline into a UIBezierPath according its configured Smoother"
                click SM1 "https://web.archive.org/web/20171224222131/http://www.antigrain.com:80/research/bezier_interpolation" "Uses a heuristic developed by Maxim Shemanarev to generate smooth Bezier curves from the input polyline. Click for more information."
                click SM2 emptyCallback "Simply translates the polyline into a linear UIBezierPath directly."
                click S6 emptyCallback "Add attributes to each path, including line width and color, or a nil color to signify eraser paths"
                click S8 emptyCallback "Renders the output from the TouchPathStream to show the points of each TouchPath"
                click S9 emptyCallback "Renders the output from the PolylineStream to show the path of each Polyline"
                click S10 emptyCallback "Renders the output from the BezierStream to show its output UIBezierPaths"

                style S7 stroke-width: 2, stroke-dasharray: 5 5
            </div>
        </div>

        <script>mermaid.initialize({startOnLoad:true, securityLevel: 'loose'});</script>
    </body>
</html>
